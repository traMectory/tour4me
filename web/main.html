<!DOCTYPE html>
<html>
    <head>
        <title>tourGenerator</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
            integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
            crossorigin="" />
        <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
        integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
        crossorigin=""></script>
        <!-- head definitions go here -->
    </head>
    <body>
        <div id="map" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 0;">

        </div>

        <div style="position: fixed; z-index: 1; width: 100%; margin: 60px auto 0; padding: 20px; bottom:0; background-color:rgba(109, 100, 100, 0.5); height: auto;">
            
            <div class="input-group mb-3" style="width: auto;">
                <input type="text" id="distance" class="form-control" value="10000" aria-label="Target Distance (m)">
                <div class="input-group-append">
                    <span class="input-group-text">m</span>
                    <button type="button" class="btn btn-success" style="display:inline-block;" onclick="getPath()">Compute Path</button>
                </div>
            </div>
        </div>


        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

        <script>
            var marker;
            var map;
            var line;
            $(document).ready(function() {

                map = L.map('map').setView([51.4895, 7.40577], 14);

                var tiles = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                    maxZoom: 18,
                    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
                        'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                    id: 'mapbox/streets-v11',
                    tileSize: 512,
                    zoomOffset: -1
                }).addTo(map);

                // var polyline = L.polyline(path, {color: 'red'}).addTo(map);

                // zoom the map to the polyline

                marker = L.marker([51.4895, 7.40577], {draggable:'true'}).addTo(map);

                var polygon = L.polygon(
                [ [[900, -1800],
                    [900, 1800],
                    [-900, 1800],
                    [-900, -1800]], // outer ring
                    [[51.264669598520314, 7.044686875922112],
                    [51.264669598520314, 7.766853124077887],
                    [51.71433040147967, 7.766853124077887 ],
                    [51.71433040147967, 7.044686875922112]] // actual cutout polygon
                ], {interactive: false, color: 'red'}).addTo(map);

                
            });

            function getPath() {

                var lat = marker.getLatLng()["lat"];
                var lon = marker.getLatLng()["lng"];
                var dis = document.getElementById("distance").value

                if (isNaN(dis)) 
                {
                    alert("Must input numbers");
                    return false;
                }


                $.ajax({
                    url: "http://localhost:8080/tour?dis=" + dis + "&lat="+ lat + "&lon=" + lon,
                    contentType: "application/json",
                    dataType: 'json',
                    success: function(result){
                        if (line) {
                            line.remove(map);
                        }
                        line = L.polyline(result["path"], {color: 'blue'}).addTo(map);
                        console.log(result);
                        // map.fitBounds(line.getBounds());
                    }
                })
            }

        </script>


    </body>

</html>